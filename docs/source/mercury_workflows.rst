=======================
Mercury Workflow Series
=======================

The Mercury workflow series was developed to allow users to efficiently and accurately prepare submission files for GISAID, SRA, and Genbank submissions as well as BioSample registration. As of today (November 11th, 2021) these workflows are specific to SARS-CoV-2 amplicon read data from clinical samples, but work is underway to allow for the submission preparation of other viral pathogens of concern. 

These workflows were written to ingest and properly format all suggested meatadata fields as per the `Public Health Alliance for Genomic Epidemiology's SARS-CoV-2 Contextual Data Specifications,<https://github.com/pha4ge/SARS-CoV-2-Contextual-Data-Specification>`.


Mercury Workflows for Single-Sample Preparation
-----------------------------------------------

Sharing of sample read and assembly data through internationally accessible databases allows insights to be drawn about how the virus is spreading and mutating across the globe; the more freely available these data are to international researchers and public health scientists, the stronger our decision making can be.

The Mercury workflows for single-sample preparation is made up of two separate WDL workflows, Mercury_SE_Prep & Mercury_PE_Prep, for preparing submission files to GISAID, SRA, and GenBank for single and paired-end read data, respectively. These two workflows will process read data, assembly files, and contextual metadata to prepare submission for samples individually--while these workflows can process multiple samples in a single run, the submission files prepared are for single-sample submission; for preparation of multiple samples (i.e. batch submission), please see details for the Mercury_Batch workflow below. 

.. figure:: images/Mercury_Prep.png
   :width: 800
   :alt: Mercury_Prep 
   :figclass: align-center

   **Mercury_Prep Data Workflow**

Mercury_PE_Prep
===============
The Mercury_PE_Prep workflow was written to process paired-end read data, assembly files, and contextual metadata to prepare submission for samples individually. 

.. note::
  With default settings, this workflow will only prepare submission files for samples with assembly files containing less than 5,000 Ns. This quality threshold can be adjusted by modifying the number_N_threshold. 

 More information on required user inputs, optional user inputs, default tool parameters and the outputs generated by Mercury_SE_Prep are outlined below.
 
 Required User Inputs
 ********************
 Download CSV: :download:`Titan_Illumina_PE_required_inputs.csv <tables/titan_workflows/titan_illumina_pe_required_inputs.csv>`

 .. csv-table::
    :file: tables/titan_workflows/titan_illumina_pe_required_inputs.csv
    :widths: 20, 20, 20, 40
    :header-rows: 1

 |

 Optional User Inputs
 ********************

 Download CSV: :download:`Titan_Illumina_PE_optional_inputs.csv <tables/titan_workflows/titan_illumina_pe_optional_inputs.csv>`

 .. csv-table::
   :file: tables/titan_workflows/titan_illumina_pe_optional_inputs.csv
   :widths: 10, 10, 10, 10, 20
   :header-rows: 1

 |

 Outputs
 ********************
 Download CSV: :download:`Titan_Illumina_PE_default_outputs.csv <tables/titan_workflows/titan_illumina_pe_outputs.csv>`

 .. csv-table::
    :file: tables/titan_workflows/titan_illumina_pe_outputs.csv
    :widths: 20, 20, 60
    :header-rows: 1

 |

 Mercury_SE_Prep
 ================
 The Mercury_SE_Prep workflow was written to process single-end read data, assembly files, and contextual metadata to prepare submission for samples individually. 

 .. note::
   With default settings, this workflow will only prepare submission files for samples with assembly files containing less than 5,000 Ns. This quality threshold can be adjusted by modifying the number_N_threshold. 

 More information on required user inputs, optional user inputs, default tool parameters and the outputs generated by Mercury_SE_Prep are outlined below.
 
 Required User Inputs
 ********************
 Download CSV: :download:`Titan_Illumina_PE_required_inputs.csv <tables/titan_workflows/titan_illumina_pe_required_inputs.csv>`

 .. csv-table::
    :file: tables/titan_workflows/titan_illumina_pe_required_inputs.csv
    :widths: 20, 20, 20, 40
    :header-rows: 1

 |

 Optional User Inputs
 ********************

 Download CSV: :download:`Titan_Illumina_PE_optional_inputs.csv <tables/titan_workflows/titan_illumina_pe_optional_inputs.csv>`

 .. csv-table::
   :file: tables/titan_workflows/titan_illumina_pe_optional_inputs.csv
   :widths: 10, 10, 10, 10, 20
   :header-rows: 1

 |

 Outputs
 ********************
 Download CSV: :download:`Titan_Illumina_PE_default_outputs.csv <tables/titan_workflows/titan_illumina_pe_outputs.csv>`

 .. csv-table::
    :file: tables/titan_workflows/titan_illumina_pe_outputs.csv
    :widths: 20, 20, 60
    :header-rows: 1

 |

Mercury Workflows for Multiple-Sample (Batch) Preparation
---------------------------------------------------------

We have made a single WDL workflow for multiple-sample (batch) preparation: Mercury_Batch. 

.. figure:: images/Mercury_Batch.png
   :width: 800
   :alt: Mercury_Prep 
   :figclass: align-center

   **Mercury_BatchData Workflow**




Mercury_Batch
===============
The Mercury_Batch workflow was written to process the output submission files from Mercury_PE_Prep or Mercury_SE_Prep and combine them to enable GISAID, SRA, and Genbank batch submission as well as batch BioSample registration. To avoid issues with NCBI GenBank rejections, the Mercury_Batch workflow will remove any sample with raised `VADR alerts<https://github.com/ncbi/vadr>` from the prepared batch submission files. 

.. note::
  With default settings, this workflow will remove samples any sample with one or more raised VADR alerts. This screening threshold can be adjusted by modifying the vadr_threshold. 

More information on required user inputs, optional user inputs, default tool parameters and the outputs generated by Mercury_Batch are outlined below.





